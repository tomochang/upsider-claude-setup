# Plan → 実装の並列実行ルール

## 原則

**独立したタスクは常に並列で実行する。** 依存関係がある場合のみ直列にする。

## Plan モード終了 → 実装開始時

1. **プランファイルをタスク単位に分解する**
   - 各タスクに依存関係を明示（blocks / blockedBy）
   - 依存なし = 並列可能

2. **並列可能タスクは1メッセージで同時起動**
   - 独立したファイル読み込み → 複数 Read を1メッセージ
   - 独立したファイル編集 → 複数 Edit を1メッセージ
   - 独立した調査 → 複数 Task (subagent) を1メッセージ
   - 独立したコマンド → 複数 Bash を1メッセージ

3. **依存チェーンは直列**
   - スキーマ → API → フロントエンド（前段の出力が後段の入力）
   - ファイル作成 → そのファイルのテスト実行
   - git add → git commit（同一トランザクション内は `&&` で連結）

## ツール呼び出しの並列パターン

### やる（並列）

```
1メッセージで:
- Read(fileA) + Read(fileB) + Read(fileC)
- Bash(test frontend) + Bash(test backend)  ← 独立なら
- Task(調査A) + Task(調査B)
- Edit(fileA) + Edit(fileB)  ← 異なるファイル
- Grep(patternA) + Grep(patternB)
```

### やらない（直列にすべき）

```
- Edit(fileA) → その結果を見て Edit(fileB)  ← 依存あり
- Write(新ファイル) → Read(そのファイル)
- Bash(npm install) → Bash(npm test)
```

## サブエージェント並列起動の条件

以下の**すべて**を満たす場合、Task tool で並列起動する:

- 3つ以上の独立タスクがある
- タスク間で共有状態がない
- ファイル編集範囲が重複しない

## 注意事項

- 並列ツール呼び出しで1つが失敗すると兄弟も全キャンセルされる場合がある → 失敗時は個別にリトライ
- サブエージェントは他のサブエージェントを起動できない（階層は1段のみ）
- 並列化のためにコードの正確性を犠牲にしない
